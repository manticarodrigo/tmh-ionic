
<ion-header>
    <ion-navbar>
        <img src="assets/chat.png">
        <ion-title class="title" *ngIf="user">
            {{ user.first_name }}
        </ion-title>
        <ion-title class="title" *ngIf="!user">
            Chat
        </ion-title>
        <ion-buttons end>
            <button class="exit" ion-fab (click)="dismiss()">
                <img src="assets/exit.png">
            </button>
        </ion-buttons>
    </ion-navbar>
</ion-header>

<ion-content>
    <p class="alert-text" *ngIf="!messages || messages.length < 1">Hello and welcome to your personal design studio! As soon as you submit your final details, we will connect you with your designer so that you two can chat. The 10 day design period begins once you recieve your initial concept boards. Thank you!</p>
    <ion-list no-lines>
        <ion-item *ngFor="let message of messages">
            <div class="message-header">
                <img *ngIf="memberMap[message.senderId]" [src]="memberMap[message.senderId].image">
                <img *ngIf="!memberMap[message.senderId]" src="assets/tmh.png">
                <h4 *ngIf="memberMap[message.senderId]">{{ memberMap[message.senderId].first_name }}</h4>
                <h4 *ngIf="!memberMap[message.senderId]">TMH BOT</h4>
                <p *ngIf="message.createdAtReadable">{{ message.createdAtReadable }}</p>
            </div>
            <div *ngIf="message.text" class="message-bubble">
                <div class="message">{{ message.text }}</div>
            </div>
            <div *ngIf="fileMap[message.fileEntryId]" class="img-bubble">
                <a href="{{ fileMap[message.fileEntryId].url }}" target="_blank"> <!-- cordova: (click)="showImage(fileMap[message.fileEntryId].url)" -->
                    <img src="{{ fileMap[message.fileEntryId].url }}">
                </a>
            </div>
        </ion-item>
    </ion-list>
</ion-content>
<ion-footer class="chat-footer">
  <form name="chat-form">
    <input type="file" accept="image/*" #file (change)="fileChanged($event)" style="visibility:hidden" />
    <button class="attach" type="button" (click)="file.click()"> <!-- cordova: (click)="presentActionSheet()" -->
        <img src="assets/attach.png">
    </button>
    <div class="chat-message">
        <ion-textarea type="text" name="chat-message" [(ngModel)]="message.text" placeholder="Enter a message" autocorrect="on"></ion-textarea>
    </div>
    <button ion-button class="send" type="button" (click)="send()">
        SEND
    </button>
  </form>
</ion-footer>